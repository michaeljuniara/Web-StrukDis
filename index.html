<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengatur Denah Anti-Circle</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            scrollbar-width: 0;
        }

        h1 { color: #333; }

        /* --- INPUT SECTION --- */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        .input-group-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .circle-card {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            background: #fff;
        }

        .circle-header {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-dot {
            width: 15px; height: 15px;
            border-radius: 50%;
            display: inline-block;
        }

        textarea {
            width: 100%;
            height: 60px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
            font-size: 14px;
            resize: vertical;
        }

        .actions {
            display: flex;
            gap: 10px;
            align-items: center;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-add { background-color: #2ecc71; color: white; }
        .btn-add:hover { background-color: #27ae60; }

        .btn-gen { background-color: #3498db; color: white; }
        .btn-gen:hover { background-color: #2980b9; }

        input[type="number"] {
            width: 50px;
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* --- OUTPUT SECTION (CLASSROOM) --- */
        #classroom {
            display: grid;
            gap: 15px;
            margin-top: 20px;
            /* Grid template akan di-set lewat JS */
        }

        .desk {
            width: 100px;
            height: 80px;
            background-color: #e0e0e0; /* Warna meja default */
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 0 #bbb; /* Efek 3D meja */
            position: relative;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .desk:hover { transform: translateY(-2px); }

        .student-name {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            z-index: 2;
        }

        .circle-label {
            font-size: 10px;
            margin-top: 4px;
            background: rgba(255,255,255,0.7);
            padding: 2px 6px;
            border-radius: 10px;
            color: #000;
        }

        .empty-desk {
            background-color: #f0f0f0;
            color: #aaa;
            box-shadow: none;
            border: 2px dashed #ccc;
        }

    </style>
</head>
<body>

    <h1>üè´ Pengatur Tempat Duduk Anti-Circle</h1>

    <div class="controls">
        <div id="inputContainer" class="input-group-container">
            </div>

        <div class="actions">
            <button class="btn-add" onclick="addNewCircle()">+ Tambah Grup  </button>
            
            <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                <label>Baris: <input type="number" id="rows" value="0" min="0" step="1" inputmode="numeric" pattern="[0-9]*" oninput="preventInvalidNumberInput(this)"></label>
                <label>Kolom: <input type="number" id="cols" value="0" min="0" step="1" inputmode="numeric" pattern="[0-9]*" oninput="preventInvalidNumberInput(this)"></label>

                <button class="btn-gen" onclick="generateLayout()">GENERATE DENAH</button>
            </div>
        </div>
    </div>

    <div id="classroom"></div>

    <script>
    const colors = [
        { name: "Merah", hex: "#ffadad" },
        { name: "Kuning", hex: "#fdffb6" },
        { name: "Hijau", hex: "#caffbf" },
        { name: "Biru", hex: "#a0c4ff" },
        { name: "Ungu", hex: "#bdb2ff" },
        { name: "Oranye", hex: "#ffd6a5" }
    ];

    let activeCircles = 0;

    window.onload = () => {
        addNewCircle();
        addNewCircle();
    };

    function addNewCircle() {
        if (activeCircles >= colors.length) {
            alert("Maksimal 6 grup");
            return;
        }

        const color = colors[activeCircles];
        const div = document.createElement("div");
        div.className = "circle-card";
        div.innerHTML = `
            <div class="circle-header">
                <span class="color-dot" style="background:${color.hex}"></span>
                ${color.name}
            </div>
            <textarea id="input-${activeCircles}" placeholder="Nama dipisah koma / enter"></textarea>
        `;
        document.getElementById("inputContainer").appendChild(div);
        activeCircles++;
    }

    function generateLayout() {
        const rows = +document.getElementById("rows").value;
        const cols = +document.getElementById("cols").value;

        let groups = {};
        let maxLen = 0;

        for (let i = 0; i < activeCircles; i++) {
            const raw = document.getElementById(`input-${i}`).value;
            const names = raw.split(/[\n,]+/).map(x => x.trim()).filter(Boolean);
            if (names.length) {
                groups[colors[i].name] = {
                    names,
                    hex: colors[i].hex
                };
                maxLen = Math.max(maxLen, names.length);
            }
        }

        // Round-robin list
        let students = [];
        const keys = Object.keys(groups);
        for (let i = 0; i < maxLen; i++) {
            keys.forEach(k => {
                if (groups[k].names[i]) {
                    students.push({
                        name: groups[k].names[i],
                        group: k,
                        hex: groups[k].hex
                    });
                }
            });
        }

        renderGridSafe(students, rows, cols);
    }
    function renderGridSafe(students, rows, cols) {
        const classroom = document.getElementById("classroom");
        classroom.innerHTML = "";
        classroom.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

        const total = rows * cols;
        let grid = Array(total).fill(null);

        function isValid(pos, student) {
            const r = Math.floor(pos / cols);
            const c = pos % cols;

            const neighbors = [
                [r - 1, c],
                [r + 1, c],
                [r, c - 1],
                [r, c + 1]
            ];

            return neighbors.every(([nr, nc]) => {
                if (nr < 0 || nr >= rows || nc < 0 || nc >= cols) return true;
                const idx = nr * cols + nc;
                return !grid[idx] || grid[idx].group !== student.group;
            });
        }

        function backtrack(index) {
            if (index === students.length) return true;

            for (let pos = 0; pos < total; pos++) {
                if (!grid[pos] && isValid(pos, students[index])) {
                    grid[pos] = students[index];
                    if (backtrack(index + 1)) return true;
                    grid[pos] = null; // undo
                }
            }
            return false;
        }

        if (!backtrack(0)) {
            alert("‚ùå Tidak ada solusi valid");
            return;
        }

        for (let i = 0; i < total; i++) {
            const desk = document.createElement("div");

            if (grid[i]) {
                desk.className = "desk";
                desk.style.backgroundColor = grid[i].hex;
                desk.innerHTML = `
                    <span class="student-name">${grid[i].name}</span>
                    <span class="circle-label">${grid[i].group}</span>
                `;
            } else {
                desk.className = "desk empty-desk";
                desk.innerHTML = `<span style="font-size:12px">Kosong</span>`;
            }

            classroom.appendChild(desk);
        }
    }
    function preventInvalidNumberInput(input) {
    // Hapus semua selain digit 0‚Äì9
    input.value = input.value.replace(/[^0-9]/g, '');

    // Hilangkan leading zero (kecuali "0")
    input.value = input.value.replace(/^0+(?=\d)/, '');

    // Jika kosong, set ke 0
    if (input.value === '') input.value = '0';
}

</script>

</body>
</html>
